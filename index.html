<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lueur dâ€™Ã‚mes - Boutique de Bougies</title>
 <style>
  header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: #3c2870;
    padding: 1rem 2rem;
    position: sticky;
    top: 0;
    z-index: 1000;
  }

  /* Menu bouton + liste dÃ©roulante verticale */
  .menu-wrapper {
    position: relative;
  }
  #menuBtn {
    background: #5a4099;
    border: none;
    color: #f2e9f7;
    padding: 0.4rem 1rem;
    font-size: 1rem;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
    user-select: none;
  }
  #menuBtn:hover {
    background: #7a56d1;
  }

  .menu-list {
    position: absolute;
    top: 100%;
    left: 0;
    background: #462f85;
    border-radius: 0 0 10px 10px;
    box-shadow: 0 6px 12px rgba(0,0,0,0.5);
    min-width: 180px;
    padding: 0.5rem 0;
  }
  .menu-list ul {
    list-style: none;
  }
  .menu-list li {
    margin: 0;
  }
  .menu-list button.category-btn {
    width: 100%;
    background: transparent;
    border: none;
    color: #d6b8ff;
    padding: 0.6rem 1.2rem;
    text-align: left;
    font-size: 1rem;
    cursor: pointer;
    transition: background-color 0.3s;
  }
  .menu-list button.category-btn:hover,
  .menu-list button.category-btn.active {
    background: #7a56d1;
    color: white;
  }

  /* Nom marque centrÃ© */
  .brand-name {
    font-size: 1.8rem;
    font-weight: 800;
    color: #bb8cff;
    user-select: none;
    text-shadow: 0 0 6px #d0a9ff88;
    flex: 1;
    text-align: center;
  }

  /* Header icons (compte + panier) Ã  droite */
  .header-icons {
    display: flex;
    gap: 1.5rem;
    align-items: center;
    font-size: 1.4rem;
    cursor: pointer;
    position: relative;
  }
  .header-icons .icon {
    color: #d6b8ff;
    position: relative;
  }
  .header-icons .icon.cart::after {
    content: attr(data-count);
    position: absolute;
    top: -8px;
    right: -10px;
    background: #ff4081;
    color: white;
    font-size: 0.7rem;
    padding: 2px 6px;
    border-radius: 50%;
    display: none;
  }
  .header-icons .icon.cart[data-count]:not([data-count="0"])::after {
    display: block;
  }
</style>
</head>
<body>
 <header>
  <div class="menu-wrapper">
    <button id="menuBtn" aria-haspopup="true" aria-expanded="false" aria-controls="menuList">
      Menu â–¼
    </button>
    <nav id="menuList" class="menu-list" hidden>
      <ul>
        <li><button class="category-btn" data-category="all">Toutes les bougies</button></li>
        <li><button class="category-btn" data-category="lueur">Gamme Lueur dâ€™Ã‚mes</button></li>
        <!-- ajoute d'autres catÃ©gories ici -->
      </ul>
    </nav>
  </div>

  <div class="brand-name" aria-label="Nom de la marque">Lueurs d'Ã‚mes</div>

  <div class="header-icons">
    <div class="icon account" title="Mon compte" aria-label="Mon compte">ðŸ‘¤</div>
    <div class="icon cart" title="Panier" aria-label="Panier" data-count="0" id="cartCount">ðŸ›’</div>
  </div>
</header>

  <main>
    <div class="products-grid" id="productsGrid">
      <!-- Les produits seront injectÃ©s ici -->
    </div>
  </main>

  <div id="message"></div>

  <script>
    // URL de ton backend Vercel (remplace par ta vraie URL)
    const BACKEND_URL = 'https://stripe-backend-8jzac1158-lueurs-dames-projects.vercel.app';

    // DonnÃ©es produits complÃ¨tes
    const products = [
      {
        id: "lueur-espoir",
        name: "Lueur dâ€™Espoir",
        desc: "Une bougie pour les moments de doute, offrant une lumiÃ¨re intÃ©rieure et un message d'encouragement.",
        scent: "Notes d'agrumes et de menthe poivrÃ©e pour une sensation de fraÃ®cheur et de renouveau.",
        price_cents: 1500 // en centimes (15â‚¬)
      },
      {
        id: "lueur-amour",
        name: "Lueur dâ€™Amour",
        desc: "DestinÃ©e Ã  raviver les relations, cette bougie diffuse une Ã©nergie chaleureuse et un message d'affection.",
        scent: "Rose et vanille, pour une ambiance chaleureuse et romantique.",
        price_cents: 1600
      },
      {
        id: "lueur-serenite",
        name: "Lueur de SÃ©rÃ©nitÃ©",
        desc: "Parfaite pour les instants de mÃ©ditation, elle apporte calme et Ã©quilibre, accompagnÃ©e d'un message apaisant.",
        scent: "Lavande et bois de santal, favorisant la relaxation.",
        price_cents: 1550
      },
      {
        id: "lueur-confiance",
        name: "Lueur de Confiance",
        desc: "Pour renforcer la confiance en soi, cette bougie inspire courage et dÃ©termination, avec un message motivant.",
        scent: "Bois de cÃ¨dre et musc, pour une touche de force et de stabilitÃ©.",
        price_cents: 1650
      },
      {
        id: "lueur-guerison",
        name: "Lueur de GuÃ©rison",
        desc: "IdÃ©ale pour les pÃ©riodes de transition, elle offre un message de guÃ©rison et de renouveau.",
        scent: "Camomille et eucalyptus, pour apaiser et purifier l'esprit.",
        price_cents: 1580
      },
      {
        id: "lueur-intuition",
        name: "Lueur dâ€™Intuition",
        desc: "Encourage l'Ã©coute de son intuition, avec un message guidant vers la sagesse intÃ©rieure.",
        scent: "Patchouli et jasmin, stimulant l'esprit et la crÃ©ativitÃ©.",
        price_cents: 1620
      },
      {
        id: "lueur-inspiration",
        name: "Lueur dâ€™Inspiration",
        desc: "Pour stimuler la crÃ©ativitÃ©, cette bougie diffuse une Ã©nergie inspirante et un message de dÃ©couverte.",
        scent: "Fleur d'oranger et ylang-ylang, pour une ambiance florale et stimulante.",
        price_cents: 1600
      },
      {
        id: "lueur-ame",
        name: "Lueur dâ€™Ã‚me",
        desc: "La bougie phare, offrant un message profond et spirituel, invitant Ã  la rÃ©flexion personnelle.",
        scent: "Encens et myrrhe, pour une expÃ©rience spirituelle profonde.",
        price_cents: 1700
      },
    ];

    // Affichage des produits
    const productsGrid = document.getElementById('productsGrid');
    const cartCount = document.getElementById('cartCount');
    const messageDiv = document.getElementById('message');

    // RÃ©cupÃ©rer panier en localStorage ou init vide
    let cart = JSON.parse(localStorage.getItem('cart')) || {};

    // Met Ã  jour le badge panier
    function updateCartCount() {
      const totalCount = Object.values(cart).reduce((acc, item) => acc + item.quantity, 0);
      cartCount.setAttribute('data-count', totalCount);
    }

    // Affiche message temporaire
    function showMessage(msg, duration = 3000) {
      messageDiv.textContent = msg;
      messageDiv.style.display = 'block';
      setTimeout(() => {
        messageDiv.style.display = 'none';
      }, duration);
    }

    // CrÃ©e une carte produit HTML
    function createProductCard(product) {
      const card = document.createElement('div');
      card.className = 'product-card';

      card.innerHTML = `
        <div class="product-name">${product.name}</div>
        <div class="product-desc">${product.desc}</div>
        <div class="product-scent"><strong>Parfum :</strong> ${product.scent}</div>
        <div class="quantity-wrapper">
          <label for="qty-${product.id}">QuantitÃ© :</label>
          <input type="number" id="qty-${product.id}" min="1" value="1" />
        </div>
        <button class="add-to-cart-btn">Ajouter au panier - ${ (product.price_cents / 100).toFixed(2) }â‚¬</button>
      `;

      // Ajout au panier
      const btn = card.querySelector('.add-to-cart-btn');
      const qtyInput = card.querySelector('input');

      btn.addEventListener('click', () => {
        const qty = parseInt(qtyInput.value);
        if (isNaN(qty) || qty < 1) {
          showMessage('Veuillez entrer une quantitÃ© valide.');
          return;
        }

        if(cart[product.id]) {
          cart[product.id].quantity += qty;
        } else {
          cart[product.id] = {
            product,
            quantity: qty
          };
        }

        localStorage.setItem('cart', JSON.stringify(cart));
        updateCartCount();
        showMessage(`AjoutÃ© ${qty} x ${product.name} au panier !`);
      });

      return card;
    }

    // Affiche tous les produits
    function displayProducts() {
      productsGrid.innerHTML = '';
      products.forEach(p => {
        productsGrid.appendChild(createProductCard(p));
      });
    }

    // Achat complet : on rÃ©cupÃ¨re le panier, on construit l'objet Ã  envoyer backend Stripe
    async function checkout() {
      if (Object.keys(cart).length === 0) {
        showMessage('Votre panier est vide !');
        return;
      }

      // Construire lignes dâ€™items Stripe
      const line_items = Object.values(cart).map(item => ({
        price_data: {
          currency: 'eur',
          product_data: {
            name: item.product.name,
            description: item.product.desc,
          },
          unit_amount: item.product.price_cents,
        },
        quantity: item.quantity,
      }));

      try {
        const response = await fetch(BACKEND_URL + '/api/create-checkout-session', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ line_items }),
        });

        if (!response.ok) {
          throw new Error('Erreur serveur');
        }

        const data = await response.json();
        if(data.url) {
          window.location.href = data.url;
        } else {
          showMessage('Erreur lors de la crÃ©ation du paiement. Veuillez rÃ©essayer.');
        }
      } catch (error) {
        showMessage('Erreur lors de la crÃ©ation du paiement. Veuillez rÃ©essayer.');
        console.error(error);
      }
    }

    // Ajoute un bouton dâ€™achat flottant (au bas Ã  droite)
    function addCheckoutButton() {
      const btn = document.createElement('button');
      btn.textContent = 'Passer Ã  la caisse';
      btn.style.position = 'fixed';
      btn.style.bottom = '20px';
      btn.style.right = '20px';
      btn.style.background = '#bb8cff';
      btn.style.color = '#2e1a47';
      btn.style.padding = '1rem 1.5rem';
      btn.style.border = 'none';
      btn.style.borderRadius = '12px';
      btn.style.fontWeight = '700';
      btn.style.fontSize = '1.1rem';
      btn.style.cursor = 'pointer';
      btn.style.boxShadow = '0 4px 12px rgba(187,140,255,0.7)';
      btn.style.zIndex = '1500';

      btn.addEventListener('click', checkout);

      document.body.appendChild(btn);
    }

    // Initialisation
    displayProducts();
    updateCartCount();
    addCheckoutButton();
    // GÃ©rer lâ€™ouverture/fermeture du menu
  const menuBtn = document.getElementById('menuBtn');
  const menuList = document.getElementById('menuList');
  let menuOpen = false;

  menuBtn.addEventListener('click', () => {
    menuOpen = !menuOpen;
    menuList.hidden = !menuOpen;
    menuBtn.setAttribute('aria-expanded', menuOpen);
  });

  // Fermer menu si clic en dehors
  document.addEventListener('click', (e) => {
    if (!menuBtn.contains(e.target) && !menuList.contains(e.target)) {
      menuOpen = false;
      menuList.hidden = true;
      menuBtn.setAttribute('aria-expanded', false);
    }
  });

  // Filtrer les produits selon catÃ©gorie
  const categoryButtons = document.querySelectorAll('.category-btn');

  categoryButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      categoryButtons.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');

      const cat = btn.dataset.category;
      filterProducts(cat);

      // Fermer menu aprÃ¨s choix
      menuOpen = false;
      menuList.hidden = true;
      menuBtn.setAttribute('aria-expanded', false);
    });
  });

  // Modifie la fonction displayProducts pour filtre par catÃ©gorie
  function filterProducts(category) {
    productsGrid.innerHTML = '';

    let filteredProducts;
    if(category === 'all') {
      filteredProducts = products;
    } else {
      // Ici on filtre par catÃ©gorie, pour lâ€™instant on a quâ€™une catÃ©gorie 'lueur'
      // Tu peux ajouter une propriÃ©tÃ© category dans tes produits pour gÃ©rer Ã§a proprement
      filteredProducts = products.filter(p => p.id.startsWith(category));
    }

    filteredProducts.forEach(p => {
      productsGrid.appendChild(createProductCard(p));
    });
  }

  // Initialisation (aprÃ¨s que la fonction filterProducts soit dÃ©clarÃ©e)
  filterProducts('all');
  updateCartCount();
  </script>
</body>
</html>
