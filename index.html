<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lueurs d'√Çmes - Boutique</title>
  <style>
    /* --- RESET SIMPLE --- */
    * {
      box-sizing: border-box;
      margin: 0; padding: 0;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    }
    body {
      background: #faf8f5;
      color: #333;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* --- HEADER --- */
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem 2rem;
      background: #fff;
      box-shadow: 0 2px 5px rgb(0 0 0 / 0.1);
      position: sticky;
      top: 0;
      z-index: 100;
    }
    .logo {
      font-weight: 700;
      font-size: 1.5rem;
      color: #6b4226;
      cursor: default;
      flex: 1;
      text-align: center;
    }
    nav {
      display: flex;
      gap: 1.5rem;
      flex: 3;
      justify-content: flex-start;
      align-items: center;
    }
    nav button {
      background: none;
      border: none;
      font-size: 1rem;
      cursor: pointer;
      padding: 0.5rem 0.8rem;
      color: #6b4226;
      font-weight: 600;
      border-bottom: 2px solid transparent;
      transition: border-color 0.3s ease;
    }
    nav button:hover, nav button.active {
      border-bottom: 2px solid #c68c53;
    }
    .header-icons {
      display: flex;
      align-items: center;
      gap: 1rem;
      flex: 1;
      justify-content: flex-end;
    }
    .icon-button {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 1.4rem;
      color: #6b4226;
      position: relative;
    }
    .icon-button .badge {
      position: absolute;
      top: -6px;
      right: -8px;
      background: #c68c53;
      color: white;
      font-size: 0.7rem;
      font-weight: bold;
      border-radius: 50%;
      padding: 2px 6px;
    }

    /* --- SEARCH --- */
    #search-container {
      position: relative;
      width: 200px;
      transition: width 0.3s ease;
      overflow: hidden;
    }
    #search-container.collapsed {
      width: 32px;
    }
    #search-input {
      width: 100%;
      padding: 0.4rem 0.6rem;
      font-size: 1rem;
      border: 1px solid #c68c53;
      border-radius: 4px;
      outline: none;
      transition: opacity 0.3s ease;
    }
    #search-container.collapsed #search-input {
      opacity: 0;
      pointer-events: none;
    }

    /* --- MAIN PRODUITS --- */
    main {
      flex: 1;
      padding: 2rem;
      max-width: 1200px;
      margin: auto;
      display: grid;
      grid-template-columns: repeat(auto-fit,minmax(260px,1fr));
      gap: 2rem;
    }
    .product-card {
      background: white;
      border-radius: 10px;
      box-shadow: 0 3px 7px rgb(0 0 0 / 0.1);
      padding: 1rem;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      transition: transform 0.2s ease;
    }
    .product-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 7px 15px rgb(0 0 0 / 0.15);
    }
    .product-name {
      font-weight: 700;
      font-size: 1.2rem;
      margin-bottom: 0.5rem;
      color: #6b4226;
    }
    .product-desc {
      font-size: 0.9rem;
      color: #666;
      flex-grow: 1;
      margin-bottom: 0.8rem;
    }
    .product-price {
      font-weight: 600;
      color: #c68c53;
      margin-bottom: 0.5rem;
      font-size: 1.1rem;
    }
    .quantity-controls {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }
    .quantity-controls button {
      padding: 0.2rem 0.7rem;
      font-size: 1.1rem;
      cursor: pointer;
      border: 1px solid #c68c53;
      background: none;
      border-radius: 5px;
      color: #6b4226;
      user-select: none;
      transition: background-color 0.2s ease;
    }
    .quantity-controls button:hover {
      background-color: #c68c53;
      color: white;
    }
    .quantity-controls span {
      min-width: 20px;
      text-align: center;
      font-weight: 600;
      font-size: 1.1rem;
    }
    .add-to-cart {
      background-color: #c68c53;
      border: none;
      color: white;
      padding: 0.7rem 1rem;
      font-weight: 700;
      font-size: 1rem;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    .add-to-cart:hover {
      background-color: #a5632a;
    }

    /* --- PANIER --- */
    #cart-sidebar {
      position: fixed;
      top: 0; right: 0;
      width: 350px;
      max-width: 100vw;
      height: 100vh;
      background: white;
      box-shadow: -3px 0 10px rgb(0 0 0 / 0.15);
      transform: translateX(100%);
      transition: transform 0.3s ease;
      display: flex;
      flex-direction: column;
      z-index: 110;
      padding: 1rem;
    }
    #cart-sidebar.open {
      transform: translateX(0);
    }
    #cart-sidebar h2 {
      margin-bottom: 1rem;
      font-weight: 700;
      color: #6b4226;
      border-bottom: 2px solid #c68c53;
      padding-bottom: 0.5rem;
    }
    #cart-items {
      flex-grow: 1;
      overflow-y: auto;
    }
    .cart-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #eee;
      padding: 0.5rem 0;
      font-size: 0.9rem;
    }
    .cart-item .info {
      flex: 1;
    }
    .cart-item .name {
      font-weight: 600;
      color: #6b4226;
    }
    .cart-item .quantity {
      margin: 0 0.5rem;
      font-weight: 600;
    }
    .cart-item .price {
      font-weight: 700;
      color: #c68c53;
      min-width: 60px;
      text-align: right;
    }
    .cart-item button.remove-item {
      background: none;
      border: none;
      color: #a5632a;
      font-size: 1.1rem;
      cursor: pointer;
    }
    #cart-total {
      font-weight: 700;
      font-size: 1.2rem;
      color: #6b4226;
      text-align: right;
      margin: 1rem 0;
    }
    #checkout-btn {
      background-color: #c68c53;
      border: none;
      color: white;
      padding: 0.9rem;
      font-weight: 700;
      font-size: 1.1rem;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      width: 100%;
    }
    #checkout-btn:hover {
      background-color: #a5632a;
    }

    /* --- FOOTER --- */
    footer {
      text-align: center;
      padding: 1rem 0;
      font-size: 0.9rem;
      color: #999;
      background: #fff;
      margin-top: auto;
    }

    /* Responsive */
    @media(max-width: 768px) {
      main {
        grid-template-columns: 1fr 1fr;
      }
      #cart-sidebar {
        width: 100vw;
      }
    }
    @media(max-width: 480px) {
      main {
        grid-template-columns: 1fr;
      }
      nav {
        flex-wrap: wrap;
      }
    }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
</head>
<body>

<header>
  <nav aria-label="Menu principal">
    <button class="menu-btn active" data-category="all">Toutes</button>
    <button class="menu-btn" data-category="espoir">Lueur d‚ÄôEspoir</button>
    <button class="menu-btn" data-category="amour">Lueur d‚ÄôAmour</button>
    <button class="menu-btn" data-category="serenite">Lueur de S√©r√©nit√©</button>
    <button class="menu-btn" data-category="confiance">Lueur de Confiance</button>
    <button class="menu-btn" data-category="guerison">Lueur de Gu√©rison</button>
    <button class="menu-btn" data-category="intuition">Lueur d‚ÄôIntuition</button>
    <button class="menu-btn" data-category="inspiration">Lueur d‚ÄôInspiration</button>
    <button class="menu-btn" data-category="ame">Lueur d‚Äô√Çme</button>
  </nav>
  <div class="logo" aria-label="Logo Lueurs d'√Çmes">Lueurs d'√Çmes</div>
  <div class="header-icons">
    <button id="search-toggle" class="icon-button" aria-label="Recherche">
      üîç
    </button>
    <div id="search-container" class="collapsed">
      <input type="search" id="search-input" placeholder="Recherche..." aria-label="Recherche des produits" />
    </div>
    <button id="user-btn" class="icon-button" aria-label="Compte utilisateur" title="Compte utilisateur">üë§</button>
    <button id="cart-btn" class="icon-button" aria-label="Voir le panier" title="Voir le panier">
      üõí <span id="cart-count" class="badge" style="display:none;">0</span>
    </button>
  </div>
</header>

<main id="products-container" aria-live="polite" aria-label="Liste des bougies √† messages">
  <!-- Produits inject√©s ici -->
</main>

<!-- Sidebar Panier -->
<aside id="cart-sidebar" aria-label="Panier d'achat" role="region" aria-hidden="true">
  <h2>Votre panier</h2>
  <div id="cart-items"></div>
  <div id="cart-total">Total : 0 ‚Ç¨</div>
  <button id="checkout-btn" disabled>Payer</button>
</aside>

<footer>
  ¬© 2025 Lueurs d'√Çmes ‚Äî Tous droits r√©serv√©s
</footer>

<script>
  // Donn√©es produits
  const products = [
    {
      id: "espoir",
      name: "Lueur d‚ÄôEspoir",
      desc: "Une bougie pour les moments de doute, offrant une lumi√®re int√©rieure et un message d'encouragement.",
      price: 15,
      category: "espoir",
    },
    {
      id: "amour",
      name: "Lueur d‚ÄôAmour",
      desc: "Destin√©e √† raviver les relations, cette bougie diffuse une √©nergie chaleureuse et un message d'affection.",
      price: 18,
      category: "amour",
    },
    {
      id: "serenite",
      name: "Lueur de S√©r√©nit√©",
      desc: "Parfaite pour les instants de m√©ditation, elle apporte calme et √©quilibre, accompagn√©e d'un message apaisant.",
      price: 17,
      category: "serenite",
    },
    {
      id: "confiance",
      name: "Lueur de Confiance",
      desc: "Pour renforcer la confiance en soi, cette bougie inspire courage et d√©termination, avec un message motivant.",
      price: 20,
      category: "confiance",
    },
    {
      id: "guerison",
      name: "Lueur de Gu√©rison",
      desc: "Id√©ale pour les p√©riodes de transition, elle offre un message de gu√©rison et de renouveau.",
      price: 19,
      category: "guerison",
    },
    {
      id: "intuition",
      name: "Lueur d‚ÄôIntuition",
      desc: "Encourage l'√©coute de son intuition, avec un message guidant vers la sagesse int√©rieure.",
      price: 18,
      category: "intuition",
    },
    {
      id: "inspiration",
      name: "Lueur d‚ÄôInspiration",
      desc: "Pour stimuler la cr√©ativit√©, cette bougie diffuse une √©nergie inspirante et un message de d√©couverte.",
      price: 21,
      category: "inspiration",
    },
    {
      id: "ame",
      name: "Lueur d‚Äô√Çme",
      desc: "La bougie phare, offrant un message profond et spirituel, invitant √† la r√©flexion personnelle.",
      price: 25,
      category: "ame",
    },
  ];

  let cart = {};

  // Affichage des produits filtr√©s par cat√©gorie
  const productsContainer = document.getElementById("products-container");
  const menuButtons = document.querySelectorAll("nav button.menu-btn");

  function renderProducts(filter = "all") {
    productsContainer.innerHTML = "";
    const filtered = filter === "all" ? products : products.filter(p => p.category === filter);
    if(filtered.length === 0) {
      productsContainer.innerHTML = "<p>Aucun produit trouv√©.</p>";
      return;
    }
    filtered.forEach(p => {
      const card = document.createElement("div");
      card.className = "product-card";
      card.innerHTML = `
        <div class="product-name">${p.name}</div>
        <div class="product-desc">${p.desc}</div>
        <div class="product-price">${p.price.toFixed(2)} ‚Ç¨</div>
        <div class="quantity-controls">
          <button class="qty-decrease" aria-label="R√©duire quantit√©">‚àí</button>
          <span class="qty-value" aria-live="polite" aria-atomic="true">1</span>
          <button class="qty-increase" aria-label="Augmenter quantit√©">+</button>
        </div>
        <button class="add-to-cart">Ajouter au panier</button>
      `;
      productsContainer.appendChild(card);

      const qtyDecreaseBtn = card.querySelector(".qty-decrease");
      const qtyIncreaseBtn = card.querySelector(".qty-increase");
      const qtyValue = card.querySelector(".qty-value");
      const addToCartBtn = card.querySelector(".add-to-cart");

      let quantity = 1;
      qtyDecreaseBtn.addEventListener("click", () => {
        if(quantity > 1) {
          quantity--;
          qtyValue.textContent = quantity;
        }
      });
      qtyIncreaseBtn.addEventListener("click", () => {
        quantity++;
        qtyValue.textContent = quantity;
      });

      addToCartBtn.addEventListener("click", () => {
        addToCart(p.id, quantity);
      });
    });
  }

  // Filtrage menu
  menuButtons.forEach(btn => {
    btn.addEventListener("click", () => {
      menuButtons.forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      renderProducts(btn.dataset.category);
    });
  });

  renderProducts();

  // Gestion panier
  const cartBtn = document.getElementById("cart-btn");
  const cartSidebar = document.getElementById("cart-sidebar");
  const cartItemsContainer = document.getElementById("cart-items");
  const cartCountBadge = document.getElementById("cart-count");
  const cartTotalEl = document.getElementById("cart-total");
  const checkoutBtn = document.getElementById("checkout-btn");

  cartBtn.addEventListener("click", () => {
    cartSidebar.classList.toggle("open");
    cartSidebar.setAttribute("aria-hidden", !cartSidebar.classList.contains("open"));
  });

  function updateCartUI() {
    const items = Object.entries(cart);
    cartItemsContainer.innerHTML = "";
    if(items.length === 0) {
      cartItemsContainer.innerHTML = "<p>Votre panier est vide.</p>";
      cartCountBadge.style.display = "none";
      checkoutBtn.disabled = true;
      cartTotalEl.textContent = "Total : 0 ‚Ç¨";
      return;
    }
    let total = 0;
    let totalQty = 0;

    items.forEach(([productId, quantity]) => {
      const product = products.find(p => p.id === productId);
      const lineTotal = product.price * quantity;
      total += lineTotal;
      totalQty += quantity;

      const itemDiv = document.createElement("div");
      itemDiv.className = "cart-item";
      itemDiv.innerHTML = `
        <div class="info">
          <div class="name">${product.name}</div>
          <div>Quantit√©: <strong>${quantity}</strong></div>
        </div>
        <div class="price">${lineTotal.toFixed(2)} ‚Ç¨</div>
        <button aria-label="Supprimer ${product.name}" class="remove-item">√ó</button>
      `;
      cartItemsContainer.appendChild(itemDiv);

      itemDiv.querySelector(".remove-item").addEventListener("click", () => {
        delete cart[productId];
        updateCartUI();
      });
    });
    cartCountBadge.textContent = totalQty;
    cartCountBadge.style.display = totalQty > 0 ? "inline-block" : "none";
    cartTotalEl.textContent = `Total : ${total.toFixed(2)} ‚Ç¨`;
    checkoutBtn.disabled = false;
  }

  function addToCart(productId, quantity) {
    if(cart[productId]) {
      cart[productId] += quantity;
    } else {
      cart[productId] = quantity;
    }
    updateCartUI();
  }

  updateCartUI();

  // Paiement Stripe
  checkoutBtn.addEventListener("click", () => {
    if(Object.keys(cart).length === 0) return alert("Votre panier est vide.");
    
    // Pr√©parer les donn√©es pour l'API backend
    const line_items = Object.entries(cart).map(([productId, quantity]) => {
      const product = products.find(p => p.id === productId);
      return {
        price_data: {
          currency: "eur",
          product_data: { name: product.name },
          unit_amount: product.price * 100, // en centimes
        },
        quantity,
      };
    });

    fetch("/api/create-checkout-session", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ line_items }),
    })
    .then(res => res.json())
    .then(data => {
      if(data.url) {
        window.location.href = data.url; // redirection Stripe Checkout
      } else {
        alert("Erreur lors du paiement, veuillez r√©essayer.");
      }
    })
    .catch(() => alert("Erreur r√©seau, veuillez r√©essayer."));
  });

  // Recherche d√©ployante
  const searchToggle = document.getElementById("search-toggle");
  const searchContainer = document.getElementById("search-container");
  const searchInput = document.getElementById("search-input");

  searchToggle.addEventListener("click", () => {
    const collapsed = searchContainer.classList.toggle("collapsed");
    if(!collapsed) {
      searchInput.focus();
    }
  });

  searchInput.addEventListener("input", () => {
    const query = searchInput.value.toLowerCase();
    const filtered = products.filter(p => p.name.toLowerCase().includes(query) || p.desc.toLowerCase().includes(query));
    productsContainer.innerHTML = "";
    if(filtered.length === 0) {
      productsContainer.innerHTML = "<p>Aucun produit ne correspond √† votre recherche.</p>";
      return;
    }
    filtered.forEach(p => {
      const card = document.createElement("div");
      card.className = "product-card";
      card.innerHTML = `
        <div class="product-name">${p.name}</div>
        <div class="product-desc">${p.desc}</div>
        <div class="product-price">${p.price.toFixed(2)} ‚Ç¨</div>
        <div class="quantity-controls">
          <button class="qty-decrease" aria-label="R√©duire quantit√©">‚àí</button>
          <span class="qty-value" aria-live="polite" aria-atomic="true">1</span>
          <button class="qty-increase" aria-label="Augmenter quantit√©">+</button>
        </div>
        <button class="add-to-cart">Ajouter au panier</button>
      `;
      productsContainer.appendChild(card);

      let quantity = 1;
      const qtyDecreaseBtn = card.querySelector(".qty-decrease");
      const qtyIncreaseBtn = card.querySelector(".qty-increase");
      const qtyValue = card.querySelector(".qty-value");
      const addToCartBtn = card.querySelector(".add-to-cart");

      qtyDecreaseBtn.addEventListener("click", () => {
        if(quantity > 1) {
          quantity--;
          qtyValue.textContent = quantity;
        }
      });
      qtyIncreaseBtn.addEventListener("click", () => {
        quantity++;
        qtyValue.textContent = quantity;
      });

      addToCartBtn.addEventListener("click", () => {
        addToCart(p.id, quantity);
      });
    });
  });

  // Bouton utilisateur -> page compte
  document.getElementById("user-btn").addEventListener("click", () => {
    window.location.href = "compte.html";
  });
</script>

</body>
</html>
