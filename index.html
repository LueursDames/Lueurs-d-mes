<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lueurs d'Âmes - Bougies à Messages Prédictifs</title>
  <style>
    /* RESET & BASE */
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: #f9f7fd;
      color: #3c2870;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    /* HEADER */
    header {
      width: 100%;
      max-width: 1200px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: #3c2870;
      padding: 1rem 2rem;
      position: sticky;
      top: 0;
      z-index: 1000;
      color: #f2e9f7;
    }
    .menu-wrapper {
      position: relative;
    }
    #menuBtn {
      background: #5a4099;
      border: none;
      color: #f2e9f7;
      padding: 0.4rem 1rem;
      font-size: 1rem;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      user-select: none;
      transition: background-color 0.3s;
    }
    #menuBtn:hover {
      background: #7a56d1;
    }
    .menu-list {
      position: absolute;
      top: 110%;
      left: 0;
      background: #462f85;
      border-radius: 0 0 10px 10px;
      box-shadow: 0 6px 12px rgba(0,0,0,0.5);
      min-width: 180px;
      padding: 0.5rem 0;
      z-index: 1500;
    }
    .menu-list ul {
      list-style: none;
      margin: 0;
      padding: 0;
    }
    .menu-list li {
      margin: 0;
    }
    .menu-list button.category-btn {
      width: 100%;
      background: transparent;
      border: none;
      color: #d6b8ff;
      padding: 0.6rem 1.2rem;
      text-align: left;
      font-size: 1rem;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    .menu-list button.category-btn:hover,
    .menu-list button.category-btn.active {
      background: #7a56d1;
      color: white;
    }
    .brand-name {
      font-size: 1.8rem;
      font-weight: 800;
      color: #bb8cff;
      user-select: none;
      text-shadow: 0 0 6px #d0a9ff88;
      flex: 1;
      text-align: center;
    }
    .header-icons {
      display: flex;
      gap: 1rem;
      align-items: center;
      font-size: 1.4rem;
      cursor: pointer;
      position: relative;
    }
    .header-icons .icon {
      color: #d6b8ff;
      position: relative;
      user-select: none;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.7rem;
      background: transparent;
      border-radius: 6px;
      padding: 0.15rem 0.3rem;
      transition: background-color 0.25s;
    }
    .header-icons .icon:hover {
      background: #7a56d1;
    }
    .header-icons .icon.cart::after {
      content: attr(data-count);
      position: absolute;
      top: -6px;
      right: -8px;
      background: #ff4081;
      color: white;
      font-size: 0.7rem;
      padding: 2px 6px;
      border-radius: 50%;
      display: none;
      pointer-events: none;
    }
    .header-icons .icon.cart[data-count]:not([data-count="0"])::after {
      display: block;
    }

    /* SEARCH */
    .search-wrapper {
      position: relative;
      display: flex;
      align-items: center;
    }
    #searchIcon {
      cursor: pointer;
      font-size: 1.4rem;
      color: #d6b8ff;
      padding: 0.2rem 0.4rem;
      border-radius: 6px;
      transition: background-color 0.3s;
      user-select: none;
    }
    #searchIcon:hover {
      background: #7a56d1;
    }
    #searchInput {
      position: absolute;
      right: 100%;
      top: 50%;
      transform: translateY(-50%);
      width: 0;
      opacity: 0;
      padding: 0.3rem 0.6rem;
      border-radius: 6px;
      border: 1px solid #7a56d1;
      font-size: 1rem;
      background: white;
      color: #3c2870;
      transition: width 0.3s ease, opacity 0.3s ease;
      outline-offset: 2px;
    }
    #searchInput.visible {
      width: 180px;
      opacity: 1;
      right: 100%;
    }

    /* PRODUITS */
    main {
      width: 100%;
      max-width: 1200px;
      padding: 2rem 1rem;
      flex: 1;
    }
    #productsGrid {
      display: grid;
      grid-template-columns: repeat(auto-fill,minmax(280px,1fr));
      gap: 1.8rem;
    }
    .product-card {
      background: white;
      border-radius: 12px;
      padding: 1rem;
      box-shadow: 0 2px 8px rgba(60,40,112,0.1);
      display: flex;
      flex-direction: column;
      transition: transform 0.3s ease;
    }
    .product-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 6px 15px rgba(60,40,112,0.2);
    }
    .product-name {
      font-weight: 700;
      font-size: 1.1rem;
      margin-bottom: 0.3rem;
      color: #4b3285;
    }
    .product-description {
      font-size: 0.9rem;
      color: #6e5a9a;
      margin-bottom: 0.8rem;
      flex-grow: 1;
    }
    .product-price {
      font-weight: 700;
      font-size: 1.1rem;
      color: #7a56d1;
      margin-bottom: 1rem;
    }
    .quantity-wrapper {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      margin-bottom: 1rem;
    }
    .quantity-wrapper label {
      font-weight: 600;
      color: #3c2870;
    }
    .quantity-wrapper input[type="number"] {
      width: 60px;
      padding: 0.3rem 0.5rem;
      font-size: 1rem;
      border-radius: 6px;
      border: 1px solid #ccc;
      text-align: center;
    }
    .add-to-cart-btn {
      background: #7a56d1;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 0.6rem;
      font-weight: 700;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    .add-to-cart-btn:hover {
      background: #5a4099;
    }

    /* PANIER MODAL */
    #cartModal {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.3);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      padding: 1rem;
    }
    #cartModal.active {
      display: flex;
    }
    #cartContent {
      background: white;
      border-radius: 12px;
      max-width: 500px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      padding: 1.5rem 2rem;
      box-shadow: 0 0 20px rgba(60,40,112,0.3);
      display: flex;
      flex-direction: column;
    }
    #cartContent h2 {
      margin-top: 0;
      color: #3c2870;
      font-weight: 800;
      margin-bottom: 1rem;
      text-align: center;
    }
    .cart-item {
      border-bottom: 1px solid #ddd;
      padding: 0.8rem 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.8rem;
    }
    .cart-item:last-child {
      border-bottom: none;
    }
    .cart-item-name {
      font-weight: 600;
      color: #4b3285;
      flex: 2;
      min-width: 100px;
    }
    .cart-item-qty input[type="number"] {
      width: 50px;
      padding: 0.2rem 0.3rem;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-weight: 700;
      color: #7a56d1;
      text-align: center;
    }
    .cart-item-qty {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 0.4rem;
      font-weight: 700;
      color: #7a56d1;
    }
    .cart-item-price {
      flex: 1;
      text-align: right;
      font-weight: 700;
      color: #7a56d1;
    }    /* suite CSS du panier & footer */
    #cartTotal {
      font-weight: 900;
      font-size: 1.3rem;
      color: #3c2870;
      margin-top: 1rem;
      text-align: right;
    }
    #cartActions {
      display: flex;
      justify-content: space-between;
      margin-top: 1.5rem;
    }
    #cartActions button {
      padding: 0.6rem 1.2rem;
      font-weight: 700;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s;
      font-size: 1rem;
      color: white;
    }
    #btnCheckout {
      background-color: #7a56d1;
    }
    #btnCheckout:hover {
      background-color: #5a4099;
    }
    #btnCloseCart {
      background-color: #ccc;
      color: #333;
    }
    #btnCloseCart:hover {
      background-color: #aaa;
      color: #111;
    }

    footer {
      text-align: center;
      padding: 1rem 0;
      font-size: 0.9rem;
      color: #7a56d1;
    }

  </style>
</head>
<body>

<header>
  <div class="menu-wrapper">
    <button id="menuBtn" aria-haspopup="true" aria-expanded="false">Menu</button>
    <nav class="menu-list" id="menuList" aria-label="Catégories" hidden>
      <ul>
        <li><button class="category-btn active" data-category="all">Toutes</button></li>
        <li><button class="category-btn" data-category="espoir">Lueur d’Espoir</button></li>
        <li><button class="category-btn" data-category="amour">Lueur d’Amour</button></li>
        <li><button class="category-btn" data-category="serenite">Lueur de Sérénité</button></li>
        <li><button class="category-btn" data-category="confiance">Lueur de Confiance</button></li>
        <li><button class="category-btn" data-category="guerison">Lueur de Guérison</button></li>
        <li><button class="category-btn" data-category="intuition">Lueur d’Intuition</button></li>
        <li><button class="category-btn" data-category="inspiration">Lueur d’Inspiration</button></li>
        <li><button class="category-btn" data-category="ame">Lueur d’Âme</button></li>
      </ul>
    </nav>
  </div>

  <div class="brand-name">Lueurs d'Âmes</div>

  <div class="header-icons">
    <div class="search-wrapper">
      <span id="searchIcon" title="Recherche 🔍">🔍</span>
      <input type="search" id="searchInput" placeholder="Rechercher une bougie..." aria-label="Recherche" />
    </div>
    <a href="compte.html" title="Mon Compte" class="icon user" aria-label="Compte utilisateur">👤</a>
    <button class="icon cart" id="cartBtn" aria-label="Voir le panier" data-count="0">🛒</button>
  </div>
</header>

<main>
  <div id="productsGrid" aria-live="polite"></div>
</main>

<!-- MODAL PANIER -->
<div id="cartModal" role="dialog" aria-modal="true" aria-labelledby="cartTitle" tabindex="-1">
  <div id="cartContent">
    <h2 id="cartTitle">Votre Panier</h2>
    <div id="cartItems"></div>
    <div id="cartTotal">Total: 0 €</div>
    <div id="cartActions">
      <button id="btnCheckout">Payer</button>
      <button id="btnCloseCart">Fermer</button>
    </div>
  </div>
</div>

<script>
  // DATA PRODUITS
  const products = [
    {
      id: "espoir",
      name: "Lueur d’Espoir",
      description: "Une bougie pour les moments de doute, offrant une lumière intérieure et un message d'encouragement.",
      price: 20,
      category: "espoir",
      parfum: "Notes d'agrumes et de menthe poivrée",
    },
    {
      id: "amour",
      name: "Lueur d’Amour",
      description: "Destinée à raviver les relations, cette bougie diffuse une énergie chaleureuse et un message d'affection.",
      price: 22,
      category: "amour",
      parfum: "Rose et vanille",
    },
    {
      id: "serenite",
      name: "Lueur de Sérénité",
      description: "Parfaite pour les instants de méditation, elle apporte calme et équilibre, accompagnée d'un message apaisant.",
      price: 21,
      category: "serenite",
      parfum: "Lavande et bois de santal",
    },
    {
      id: "confiance",
      name: "Lueur de Confiance",
      description: "Pour renforcer la confiance en soi, cette bougie inspire courage et détermination, avec un message motivant.",
      price: 23,
      category: "confiance",
      parfum: "Bois de cèdre et musc",
    },
    {
      id: "guerison",
      name: "Lueur de Guérison",
      description: "Idéale pour les périodes de transition, elle offre un message de guérison et de renouveau.",
      price: 20,
      category: "guerison",
      parfum: "Camomille et eucalyptus",
    },
    {
      id: "intuition",
      name: "Lueur d’Intuition",
      description: "Encourage l'écoute de son intuition, avec un message guidant vers la sagesse intérieure.",
      price: 24,
      category: "intuition",
      parfum: "Patchouli et jasmin",
    },
    {
      id: "inspiration",
      name: "Lueur d’Inspiration",
      description: "Pour stimuler la créativité, cette bougie diffuse une énergie inspirante et un message de découverte.",
      price: 22,
      category: "inspiration",
      parfum: "Fleur d'oranger et ylang-ylang",
    },
    {
      id: "ame",
      name: "Lueur d’Âme",
      description: "La bougie phare, offrant un message profond et spirituel, invitant à la réflexion personnelle.",
      price: 25,
      category: "ame",
      parfum: "Encens et myrrhe",
    },
  ];

  // Variables état
  let filteredCategory = "all";
  let cart = {}; // id -> quantity
  let searchTerm = "";

  // ELEMENTS
  const menuBtn = document.getElementById("menuBtn");
  const menuList = document.getElementById("menuList");
  const productsGrid = document.getElementById("productsGrid");
  const cartBtn = document.getElementById("cartBtn");
  const cartModal = document.getElementById("cartModal");
  const cartItems = document.getElementById("cartItems");
  const cartTotal = document.getElementById("cartTotal");
  const btnCloseCart = document.getElementById("btnCloseCart");
  const btnCheckout = document.getElementById("btnCheckout");
  const searchIcon = document.getElementById("searchIcon");
  const searchInput = document.getElementById("searchInput");

  // Affiche ou cache le menu des catégories
  menuBtn.addEventListener("click", () => {
    const expanded = menuBtn.getAttribute("aria-expanded") === "true";
    menuBtn.setAttribute("aria-expanded", !expanded);
    if (menuList.hasAttribute("hidden")) {
      menuList.removeAttribute("hidden");
    } else {
      menuList.setAttribute("hidden", "");
    }
  });

  // Sélection catégorie
  menuList.querySelectorAll(".category-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      filteredCategory = btn.dataset.category;
      // Activer le bouton sélectionné
      menuList.querySelectorAll(".category-btn").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      renderProducts();
      menuList.setAttribute("hidden", "");
      menuBtn.setAttribute("aria-expanded", false);
    });
  });

  // Affichage des produits filtrés
  function renderProducts() {
    // Filtre par catégorie et recherche
    let filtered = products.filter(p => 
      (filteredCategory === "all" || p.category === filteredCategory) &&
      (p.name.toLowerCase().includes(searchTerm) || p.description.toLowerCase().includes(searchTerm))
    );

    if(filtered.length === 0) {
      productsGrid.innerHTML = "<p>Aucun produit trouvé.</p>";
      return;
    }

    productsGrid.innerHTML = filtered.map(p => `
      <article class="product-card" aria-label="${p.name}">
        <h3 class="product-name">${p.name}</h3>
        <p class="product-description">${p.description}<br><small><em>Parfum : ${p.parfum}</em></small></p>
        <div class="product-price">${p.price.toFixed(2)} €</div>
        <div class="quantity-wrapper">
          <label for="qty-${p.id}">Quantité:</label>
          <input type="number" id="qty-${p.id}" min="1" max="10" value="1" aria-label="Quantité pour ${p.name}" />
        </div>
        <button class="add-to-cart-btn" data-id="${p.id}">Ajouter au panier</button>
      </article>
    `).join("");

    // Ajout écouteur boutons panier
    productsGrid.querySelectorAll(".add-to-cart-btn").forEach(btn => {
      btn.addEventListener("click", () => {
        const id = btn.dataset.id;
        const qtyInput = document.getElementById("qty-" + id);
        let qty = parseInt(qtyInput.value);
        if (isNaN(qty) || qty < 1) qty = 1;
        addToCart(id, qty);
      });
    });
  }

  // Ajouter au panier
  function addToCart(id, qty) {
    if (cart[id]) {
      cart[id] += qty;
    } else {
      cart[id] = qty;
    }
    updateCartCount();
    alert("Ajouté au panier !");
  }

  // Mise à jour affichage nombre articles panier
  function updateCartCount() {
    const totalCount = Object.values(cart).reduce((a,b) => a + b, 0);
    cartBtn.setAttribute("data-count", totalCount);
  }

  // Afficher panier modal
  cartBtn.addEventListener("click", () => {
    renderCart();
    cartModal.classList.add("active");
    cartModal.focus();
  });

  btnCloseCart.addEventListener("click", () => {
    cartModal.classList.remove("active");
  });

  // Fermer modal avec Esc
  window.addEventListener("keydown", (e) => {
    if (e.key === "Escape" && cartModal.classList.contains("active")) {
      cartModal.classList.remove("active");
    }
  });

  // Rendu contenu panier
  function renderCart() {
    if (Object.keys(cart).length === 0) {
      cartItems.innerHTML = "<p>Votre panier est vide.</p>";
      cartTotal.textContent = "Total: 0 €";
      btnCheckout.disabled = true;
      return;
    }
    btnCheckout.disabled = false;
    cartItems.innerHTML = "";
    let total = 0;

    for (const id in cart) {
      const product = products.find(p => p.id === id);
      const quantity = cart[id];
      const linePrice = product.price * quantity;
      total += linePrice;

      const itemDiv = document.createElement("div");
      itemDiv.className = "cart-item";

      itemDiv.innerHTML = `
        <div class="cart-item-name">${product.name}</div>
        <div class="cart-item-qty">
          <label for="cartQty-${id}" class="sr-only">Quantité</label>
          <input type="number" id="cartQty-${id}" min="1" max="10" value="${quantity}" aria-label="Quantité pour ${product.name}" />
          <button aria-label="Supprimer ${product.name}" class="remove-item-btn" title="Supprimer cet article">✖</button>
        </div>
        <div class="cart-item-price">${linePrice.toFixed(2)} €</div>
      `;
      cartItems.appendChild(itemDiv);

      // Ecouteur changement quantité
      const qtyInput = itemDiv.querySelector("input[type='number']");
      qtyInput.addEventListener("change", () => {
        let val = parseInt(qtyInput.value);
        if (isNaN(val) || val < 1) val = 1;
        if (val > 10) val = 10;
        qtyInput.value = val;
        cart[id] = val;
        renderCart();
        updateCartCount();
      });

      // Ecouteur suppression article
      const removeBtn = itemDiv.querySelector(".remove-item-btn");
      removeBtn.addEventListener("click", () => {
        delete cart[id];
        renderCart();
        updateCartCount();
      });
    }

    cartTotal.textContent = `Total: ${total.toFixed(2)} €`;
  }

  // Checkout simulé
  btnCheckout.addEventListener("click", () => {
    if (Object.keys(cart).length === 0) return;

    // Simple formulaire simulé
    const confirmation = confirm(`Vous allez payer ${cartTotal.textContent.replace("Total: ", "")}. Confirmez-vous ?`);
    if (confirmation) {
      alert("Paiement effectué avec succès ! Merci pour votre achat.");
      cart = {};
      updateCartCount();
      cartModal.classList.remove("active");
    }
  });

  // Recherche togglable
  searchIcon.addEventListener("click", () => {
    if (searchInput.classList.contains("visible")) {
      searchInput.value = "";
      searchTerm = "";
      searchInput.classList.remove("visible");
      renderProducts();
    } else {
      searchInput.classList.add("visible");
      searchInput.focus();
    }
  });

  // Recherche en temps réel
  searchInput.addEventListener("input", () => {
    searchTerm = searchInput.value.trim().toLowerCase();
    renderProducts();
  });

  // Initial render
  renderProducts();
  updateCartCount();

  // Close menu if clicked outside
  document.addEventListener("click", (e) => {
    if (!menuBtn.contains(e.target) && !menuList.contains(e.target)) {
      menuList.setAttribute("hidden", "");
      menuBtn.setAttribute("aria-expanded", false);
    }
  });
</script>

<footer>
  &copy; 2025 Lueurs d'Âmes. Tous droits réservés.
</footer>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const checkoutButton = document.getElementById("payer");

    if (checkoutButton) {
      checkoutButton.addEventListener("click", () => {
        fetch("https://stripe-backend-njvcb6t6q-lueurs-dames-projects.vercel.app/api/create-checkout-session", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            items: [
              { id: 1, quantity: 1 } // ⚠️ À adapter selon ton panier
            ]
          })
        })
        .then((res) => res.json())
        .then((data) => {
          if (data.url) {
            window.location.href = data.url;
          } else {
            alert("Erreur lors de la création du paiement.");
          }
        })
        .catch((error) => {
          console.error("Erreur :", error);
          alert("Erreur lors de la création du paiement.");
        });
      });
    }
  });
</script>

</body>
</html>

